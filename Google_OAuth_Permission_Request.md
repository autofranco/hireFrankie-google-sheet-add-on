# Google OAuth 權限申請說明書
**Auto Lead Warmer - 潛在客戶自動化追蹤系統**

---

## 📋 應用程式概述

### 應用名稱
Auto Lead Warmer

### 應用類型
Google Apps Script Add-on (企業用潛在客戶管理工具)

### 應用用途
為研習活動主辦方提供參與者後續追蹤自動化服務。系統通過 AI 分析生成個人化追蹤郵件，協助主辦方維持與潛在客戶的聯繫，提升業務轉換效率。

### 目標用戶
- 研習活動主辦方
- 企業培訓機構
- 商業活動策劃公司
- 專業講師和顧問

---

## 🔐 權限申請詳細說明

### 1. `https://www.googleapis.com/auth/spreadsheets`
**申請原因**: 核心業務功能需求

#### 具體使用場景：

##### A. 工作表管理與初始化
- **獲取當前工作表**: `SpreadsheetApp.getActiveSpreadsheet()`
  - 用途：識別用戶正在操作的 Google Sheets 文件
  - 必要性：系統需要確定資料存放位置

- **創建和管理工作表**: `insertSheet()`, `getSheetByName()`, `rename()`
  - 用途：創建 "User Info" 工作表存放用戶設定
  - 必要性：分離用戶資料與客戶資料，提升資料組織性

##### B. 客戶資料讀取與處理
- **讀取客戶資料**: `getRange().getValue()`, `getRange().getValues()`
  - 用途：讀取客戶 Email、姓名、公司 URL、職位等基本資訊
  - 資料類型：客戶聯絡資訊、公司網址（公開資訊）
  - 處理目的：生成個人化的追蹤郵件內容

- **批量資料處理**: `getLastRow()`, 批量讀取多行客戶資料
  - 用途：一次處理多個潛在客戶，提升效率
  - 必要性：企業用戶通常需要處理數十到數百筆客戶資料

##### C. 處理結果寫入與狀態追蹤
- **寫入處理結果**: `setValue()`, `setValues()`
  - 用途：儲存 AI 生成的客戶畫像、郵件內容、發送排程
  - 必要性：用戶需要查看和編輯 AI 生成的內容

- **狀態管理**: 更新處理狀態 (New → Processing → Running → Completed)
  - 用途：讓用戶了解每個客戶的處理進度
  - 必要性：避免重複處理，提供透明的工作流程

##### D. 進階格式化功能
- **Sheets API batchUpdate**: `Sheets.Spreadsheets.batchUpdate()`
  - 用途：批量設定行高（200px），確保長文本正確顯示
  - 必要性：AI 生成的郵件內容較長，需要適當的行高顯示

- **欄位格式設定**: `setColumnWidth()`, `setWrap()`, `setFrozenRows()`
  - 用途：設定欄位寬度、文字換行、凍結表頭
  - 必要性：改善用戶體驗，讓資料更易閱讀

##### E. 資料驗證與使用者介面
- **資料驗證**: `newDataValidation()`, `setDataValidation()`
  - 用途：設定狀態欄位的下拉選單 (New, Processing, Running, Stopped)
  - 必要性：防止用戶輸入錯誤的狀態值

- **使用者通知**: `getUi().alert()`, `toast()`
  - 用途：顯示處理結果、錯誤訊息、操作確認
  - 必要性：提供即時回饋，改善用戶體驗

### 2. `https://www.googleapis.com/auth/gmail.send`
**申請原因**: 核心郵件發送功能

#### 具體使用場景：
- **發送追蹤郵件**: `GmailApp.sendEmail()`
  - 用途：根據排程自動發送個人化追蹤郵件給潛在客戶
  - 郵件內容：基於 AI 分析的個人化內容，包含研習活動相關資訊
  - 發送頻率：每個客戶最多 3 封，間隔 3-7 天
  - 必要性：這是系統的核心價值，自動化追蹤郵件發送

### 3. `https://www.googleapis.com/auth/gmail.readonly`
**申請原因**: 郵件回覆檢測功能

#### 具體使用場景：
- **檢測客戶回覆**: `GmailApp.search()`
  - 用途：搜索客戶是否回覆追蹤郵件
  - 搜索範圍：僅限用戶發送的追蹤郵件的回覆
  - 處理方式：檢測到回覆後停止後續郵件發送，避免打擾
  - 必要性：確保不會向已回覆的客戶繼續發送郵件

### 4. `https://www.googleapis.com/auth/script.external_request`
**申請原因**: AI 服務整合需求

#### 具體使用場景：
- **調用 Firebase Functions**: `UrlFetchApp.fetch()`
  - 用途：調用後端 AI 服務生成客戶畫像和郵件內容
  - API 端點：自有的 Firebase Functions（已部署至 Google Cloud）
  - 資料傳輸：客戶公司資訊（公開網址）和基本聯絡資訊
  - 必要性：AI 內容生成是系統的核心功能

### 5. `https://www.googleapis.com/auth/userinfo.email`
**申請原因**: 用戶身份驗證

#### 具體使用場景：
- **用戶識別**: 獲取用戶 email 地址
  - 用途：識別不同用戶，隔離用戶資料
  - 使用方式：作為用戶 ID 傳送給後端服務進行認證
  - 必要性：確保用戶只能存取自己的資料

### 6. `https://www.googleapis.com/auth/script.scriptapp`
**申請原因**: 自動化排程功能

#### 具體使用場景：
- **觸發器管理**: `ScriptApp.newTrigger()`, `getProjectTriggers()`
  - 用途：創建定時觸發器，自動檢查和發送排程郵件
  - 觸發頻率：每 10 分鐘檢查一次
  - 必要性：實現自動化郵件發送，無需用戶手動操作

---

## 🛡️ 資料安全與隱私保護

### 資料處理原則
1. **最小資料收集**: 僅收集必要的客戶聯絡資訊和公開的公司資料
2. **本地儲存**: 所有資料儲存在用戶自己的 Google Sheets 中
3. **用戶控制**: 用戶完全控制資料的存取、編輯和刪除
4. **透明處理**: 所有處理過程對用戶透明可見

### 資料安全措施
1. **加密傳輸**: 所有 API 調用使用 HTTPS 加密
2. **身份驗證**: 後端服務驗證用戶身份
3. **權限限制**: 僅存取用戶授權的工作表
4. **無永久儲存**: 後端服務不永久儲存用戶資料

### 隱私保護
1. **同意機制**: 用戶明確同意授權範圍
2. **資料用途**: 資料僅用於生成追蹤郵件
3. **第三方限制**: 不與第三方分享用戶資料
4. **撤銷權限**: 用戶可隨時撤銷授權

---

## 🎯 最小權限原則考量

### 為什麼需要完整的 `spreadsheets` 權限而非 `spreadsheets.currentonly`？

1. **多工作表管理需求**
   - 需要創建 "User Info" 工作表存放用戶設定
   - `currentonly` 無法創建新工作表

2. **進階 API 功能需求**
   - 使用 Sheets API v4 的 `batchUpdate` 功能
   - `currentonly` 不支援進階 API 操作

3. **用戶體驗考量**
   - 需要重命名工作表以提升識別性
   - `currentonly` 限制工作表管理功能

4. **資料組織需求**
   - 分離不同類型的資料（客戶資料 vs 用戶設定）
   - 確保資料結構的清晰性

### 替代方案評估
我們評估過使用 `spreadsheets.currentonly` 的可能性，但發現以下限制：
- 無法創建用戶設定工作表
- 無法使用 Sheets API 進階功能
- 無法提供完整的格式化支援
- 嚴重影響用戶體驗和功能完整性

---

## 📈 商業需求與技術必要性

### 商業需求
1. **市場需求**: 研習活動主辦方需要有效的客戶追蹤工具
2. **效率提升**: 自動化取代人工撰寫追蹤郵件
3. **個人化服務**: AI 分析提供個人化的溝通策略
4. **成本節約**: 減少人力成本，提升轉換率

### 技術必要性
1. **資料整合**: 需要整合 Google Sheets 和 Gmail
2. **AI 服務**: 需要調用外部 AI 服務進行內容生成
3. **自動化**: 需要定時觸發器實現自動化流程
4. **用戶體驗**: 需要完整的權限提供流暢的操作體驗

---

## 📞 聯絡資訊

**開發者**: HireFrankie Development Team
**Email**: anyoneelsesober@gmail.com
**技術支援**: 透過 GitHub Issues 提供技術支援

我們承諾遵守 Google 的開發者政策和隱私權政策，確保用戶資料的安全和隱私保護。如有任何疑問，歡迎與我們聯繫。

---

*申請日期: 2025年9月21日*
*文件版本: v1.0*